<project name="mjc2wsl" default="all">
    <property name="java.encoding" value="utf-8" />
    <taskdef resource="net/sf/antcontrib/antlib.xml">
        <classpath>
            <pathelement location="/usr/share/java/"/>
        </classpath>
    </taskdef>
    
    <property name="mjc2wsl.class.dir" value="bin" />
    <property name="mjc2wsl.src.dir" value="src" />
    <property name="mjc2wsl.options" value="" />
    
    <property name="compiler.class.dir" value="compiler-bin" />
    <property name="compiler.src.dir" value="compiler" />

    <property name="samples.main.dir" value="samples" />
    <property name="samples.temp.dir" value="samples-temp" />
    
    <target name="help">
        <echo>Possible options:
        all - build the tool and the compiler and test on the samples
        build - build the mjc2wsl tool
        mj-build - build the mj compiler
        mj-samples - run the mj compiler on the samples (build if needed)
        </echo>
    </target>
    
    <target name="init">
        <mkdir dir="${mjc2wsl.class.dir}"/>
        <mkdir dir="${compiler.class.dir}"/>
        <mkdir dir="${samples.temp.dir}"/>
        <copy todir="${samples.temp.dir}">
            <fileset dir="${samples.main.dir}">
                <include name="*.mj"/>
            </fileset>
        </copy>
    </target>

    <target name="build" depends="init">
        <javac srcdir="${mjc2wsl.src.dir}" destdir="${mjc2wsl.class.dir}" includeAntRuntime='no' />
    </target>

    <target name="mj-build" depends="init">
        <javac srcdir="${compiler.src.dir}" destdir="${compiler.class.dir}" includeAntRuntime='no' />
    </target>
    
    <target name="mj-compile">
        <echo message="${filename}" />
        <java classpath="${compiler.class.dir}" classname="Compiler">
            <arg value="${filename}" />
        </java>
    </target>
    
    <target name="mj-samples" depends="build">
        <foreach param="filename" target="mj-compile">
            <path>
            <fileset dir='${samples.temp.dir}'>
                <include name="*.mj"/>
            </fileset>
            </path>
        </foreach>
    </target>

    <target name="mj-samples1" depends="mj-build">
    <!-- simplistic version when antlib (foreach) is not available -->
        <antcall target="mj-compile">
            <param name="filename" value="samples-temp/sample.mj" />
        </antcall>
        <antcall target="mj-compile">
            <param name="filename" value="samples-temp/sample1.mj" />
        </antcall>
        <antcall target="mj-compile">
            <param name="filename" value="samples-temp/sample0.mj" />
        </antcall>
    </target>
    
    <target name="mjc2wsl">
        <echo message="${filename}" />
        <java classpath="${mjc2wsl.class.dir}" classname="mjc2wsl">
            <arg line="${mjc2wsl.options}" />
            <arg value="${filename}" />
        </java>
    </target>
    
    <target name="mjc2wsl-samples" depends="build">
        <foreach param="filename" target="mjc2wsl">
            <path>
            <fileset dir='${samples.temp.dir}'>
                <include name="*.obj"/>
            </fileset>
            </path>
        </foreach>
    </target>
    
    <target name="mjc2wsl-samples1" depends="build">
    <!-- simplistic version when antlib (foreach) is not available -->
        <antcall target="mjc2wsl">
            <param name="filename" value="samples-temp/sample0.obj" />
        </antcall>
    </target>
    
    <target name="all" depends='mj-samples,mjc2wsl-samples'>
    
    </target>
    
    <target name="clean" >
        <delete includeemptydirs="true">
            <fileset dir=".">
                <include name="${mjc2wsl.class.dir}/*.class"/>
                <include name="${compiler.class.dir}/*.class"/>
                <include name="${samples.temp.dir}/*"/>
            </fileset>
            <dirset dir=".">
                <include name="${mjc2wsl.class.dir}"/>
                <include name="${compiler.class.dir}"/>
                <include name="${samples.temp.dir}"/>
            </dirset>
        </delete>
    </target>
    
    <!-- jedit specific flags; needs to be the first or the last 10 lines
    :noTabs=true:
    -->
</project>